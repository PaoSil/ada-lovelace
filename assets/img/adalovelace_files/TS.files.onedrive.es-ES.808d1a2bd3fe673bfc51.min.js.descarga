webpackJsonp([311],{1484:function(e,r){(function(){TS.registerModule("files.onedrive",{onStart:function e(){if(!TS.client)return;TS.files.team_file_shared_sig.add(d)},openPickerWindow:function i(){var s=null;return new Promise(function(n,o){$("<iframe>",{src:e,id:"onedrive_picker_iframe"}).appendTo("body").hide();s=a(n,o);window.addEventListener("message",s);if(r)o("Promise already made");r=true}).then(function(e){r=false;return t(e.chosen_files,TS.shared.getActiveModelOb())}).catch(function(e){if("Promise already made"===e)return;var a=n;TS.error(e);if(("unidentified_external_url"===e.data.error||"file_type_has_no_handler"===e.data.error)&&e.args.link)a=TS.i18n.t("De momento no es posible importar ese tipo de archivo de OneDrive, pero hemos incluido un enlace para que los demás puedan acceder a él.","files")();if("filename_too_long"===e.data.error)a=o;TS.client.ui.addEphemeralBotMsg({text:a,ephemeral_type:"file_type_has_no_handler",slackbot_feels:"sad_surprise"});r=false}).finally(function(){$("#onedrive_picker_iframe").remove();window.removeEventListener("message",s)})}});var e=TS.boot_data.team_url+"files/import/onedrive";var r=false;var n=TS.i18n.t("Jolín, no ha funcionado. Vuelve a intentarlo o <https://my.slack.com/help/requests/new|contactános>  si sigue sin funcionar.","files")();var o=TS.i18n.t("¡Lo sentimos! El nombre del archivo es demasiado grande y no podemos procesarlo. Prueba importando un archivo con un nombre más corto, por favor.","files")();var a=function e(r,n){return i({resolve:r,reject:n,method:"onedrive_picker"})};var i=function e(r){return function(e){if(e.data.method!==r.method)return;if(!e.data.ok)r.reject(new Error(r.method+" not ok"));else r.resolve(e.data)}};var t=function e(r,n){var o=r.map(function(e){return s(e,n)});return Promise.all(o)};var s=function e(r,n){return TS.api.call("files.uploadExternal",{channels:n.id,link:r}).then(function(e){TS.log(9999,"TODO");TS.log(9999,e)})};var d=function e(r){if("onedrive"!==_.get(r,"external_type"))return;if(_.get(r,"user")!==TS.model.user.id)return;if(!TS.prefs.getTeamPref("onedrive_enabled_team"))return;if(TS.prefs.getPref("seen_onedrive_coachmark"))return;TS.coachmark.start(TS.coachmarks.coachmarks.onedrive);TS.prefs.setPref("seen_onedrive_coachmark",true);TS.prefs.setPrefByAPI({name:"seen_onedrive_coachmark",value:true})}})()}},[1484]);